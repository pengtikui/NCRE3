# 路由设计基础

## 分组转发的基本概念

是指在互联网络中路由器转发 IP 分组的物理传输过程与数据报转发机制

一台主机通常是与一台路由器相连接，这台路由器就是该主机的默认路由器，又称为第一跳路由器或缺省路由器

## 自治系统与 Internet 的路由选择协议

### 自治系统的基本概念

Internet 采用分层的路由选择协议，并且将整个 Internet 划分为许多较小的自治系统

它有权决定本系统内应采用何种路由选择协议

### Internet 路由选择协议的分类

分为两大类：内部网关协议（Interior Gateway Protocol, IGP）和外部网关协议（External Gateway Protocol, EGP）

内部网关协议主要有：路由信息协议（Routing Informantion Protocol, RIP）和开放最短路径优先（Open Shortest Path First, OSPF）

> 路由选择算法和路由选择协议在概念上是不同的。网络上的主机、路由器通过路由选择算法去形成路由表，以确定发送分组的传输路径；而路由选择选择协议是由路由器用来完成路由表建立和路由信息更新的通信协议

## 内部网关协议 IGP

### 路由信息协议（RIP）的基本概念

路由信息协议是内部网关协议中使用得最广泛的一种协议，它是一种分布式、基于距离向量的路由选择协议，其特点是协议简单

* 直径跳数（hop count）一般小于 15

## 最短路径优先协议 OSPF

* 分布式链路状态协议
* OSPF 协议将一个自治系统再划分为若干个更小的范围，叫做区域，每个区域又一个 32 位的区域标识符，在一个区域内的路由器数不超过 200 个

### 自治系统内部的区域划分

OSPF 协议使用层次结构的区域划分，将一个自治系统内部划分成若干区域与主干区域，主干区域连接多个区域，主干区域内部的路由器叫做主干路由器，连接各个区域的路由器叫做区域边界路由器

#### 网络运行过程

* 在网络运行的过程中，只要一个路由器的链路状态发生变化，该路由器就要使用链路状态更新分组，用洪泛法向全网更新链路状态
* 为了确保链路状态数据库与全网的状态保持一致，规定每隔一段时间（例如 30 分钟）要刷新一次数据库中的链路状态
* 由于一个路由器的链路状态只涉及与相邻路由器的连接状态，因而与整个 Internet 的规模无关
* 通过个路由器之间交换链路状态信息，每一个路由器都可得出该网络的链路状态数据库。每个路由器中的路由表可以从这个链路状态数据库出发，计算出以本路由器为根的最短路径树，再根据最短路径树得出路由表

## 外部网关协议

外部网关协议是不同自治系统的路由器之间交换路由信息的协议

新版本 BGP-4 是再 1995 年发布的并已成为 Internet 草案标准协议

一个 BGP 发言人与其他自治系统中的 BGP 发言人要交换路由信息，就要先建立 **TCP 连接**，然后在此连接上交换 BGP 报文以建立 BGP 会话

> 对于只考虑用最短距离找出来的路由，当考虑到路由的使用费用和安全性时，那么选用的路由可能并不是人们所期待的

#### BGP 路由选择协议的四种分组

* 打开分组
* 更新分组
* 保活分组
* 通知分组